<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>用户管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://unpkg.com/amis@6.0.0/sdk/sdk.css" rel="stylesheet" />
    <script src="https://unpkg.com/amis@6.0.0/sdk/sdk.js"></script>
</head>
<body>
<div id="root"></div>

<script>
    (function () {
        const amis = amisRequire('amis/embed');

        const schema = {
            type: "page",
            title: "用户管理",
            body: {
                type: "crud",
                api: {
                    method: "post",
                    url: "/api/user/list",
                    requestAdaptor: function (api) {
                        const body = {
                            username: api.data.username || "",
                            page: api.data.page || 1,
                            size: api.data.perPage || 10
                        };
                        return {
                            ...api,
                            data: body
                        };
                    },
                    adaptor: function (payload) {
                        return {
                            status: payload.status === 0 ? 0 : 1,
                            msg: payload.message || '',
                            data: {
                                items: payload.data.records,
                                total: payload.data.total
                            }
                        };
                    }
                },
                filter: {
                    title: "条件查询",
                    submitText: "",
                    body: [
                        {
                            type: "input-text",
                            name: "username",
                            label: "用户名",
                            placeholder: "请输入用户名"
                        },
                        {
                            type: "submit",
                            label: "查询",
                            level: "primary"
                        }
                    ]
                },
                perPage: 10,
                columns: [
                    { name: "id", label: "ID", sortable: true },
                    { name: "username", label: "用户名" },
                    { name: "name", label: "姓名" },
                    { name: "phone", label: "电话" },
                    { name: "department", label: "单位" },
                    { name: "position", label: "职位" },
                    { name: "age", label: "年龄" },
                    { name: "gender", label: "性别" },
                    {
                        name: "roleId",
                        label: "角色",
                        type: "mapping",
                        map: {
                            1: "管理员",
                            2: "普通用户",
                            '*': "未知角色"
                        }
                    },
                    {
                        name: "createdAt",
                        label: "创建时间",
                        type: "date",
                        format: "YYYY-MM-DD HH:mm:ss"
                    },
                    {
                        type: "operation",
                        label: "操作",
                        buttons: [
                            {
                                label: "编辑",
                                type: "button",
                                level: "link",
                                actionType: "dialog",
                                dialog: {
                                    title: "编辑用户",
                                    body: {
                                        type: "form",
                                        api: "put:/user/${id}", // 请根据实际情况更改
                                        body: [
                                            { name: "name", type: "input-text", label: "姓名", required: true },
                                            { name: "phone", type: "input-text", label: "电话" },
                                            { name: "department", type: "input-text", label: "单位" },
                                            { name: "position", type: "input-text", label: "职位" },
                                            { name: "age", type: "input-number", label: "年龄" },
                                            {
                                                name: "gender",
                                                type: "select",
                                                label: "性别",
                                                options: ["男", "女"]
                                            },
                                            {
                                                name: "roleId",
                                                type: "select",
                                                label: "角色",
                                                options: [
                                                    { label: "管理员", value: 1 },
                                                    { label: "普通用户", value: 2 }
                                                ]
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                label: "删除",
                                type: "button",
                                level: "link",
                                className: "text-danger",
                                confirmText: "确定要删除该用户吗？",
                                actionType: "ajax",
                                api: "delete:/user/${id}"
                            }
                        ]
                    }
                ],
                headerToolbar: [
                    {
                        label: "新增用户",
                        type: "button",
                        actionType: "dialog",
                        level: "primary",
                        dialog: {
                            title: "新增用户",
                            body: {
                                type: "form",
                                api: "post:/user", // 请根据你的新增接口改
                                body: [
                                    { name: "username", type: "input-text", label: "用户名", required: true },
                                    { name: "name", type: "input-text", label: "姓名", required: true },
                                    { name: "phone", type: "input-text", label: "电话" },
                                    { name: "department", type: "input-text", label: "单位" },
                                    { name: "position", type: "input-text", label: "职位" },
                                    { name: "password", type: "input-password", label: "密码", required: true },
                                    { name: "age", type: "input-number", label: "年龄" },
                                    {
                                        name: "gender",
                                        type: "select",
                                        label: "性别",
                                        options: ["男", "女"]
                                    },
                                    {
                                        name: "roleId",
                                        type: "select",
                                        label: "角色",
                                        options: [
                                            { label: "管理员", value: 1 },
                                            { label: "普通用户", value: 2 }
                                        ]
                                    }
                                ]
                            }
                        }
                    }
                ]
            }
        };

        amis.embed("#root", schema);
    })();
</script>
</body>
</html>
